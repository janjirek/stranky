import{l as f,t as p}from"./util.BpmjTJwX.js";var g={abort:"onAbort","batch-cancelled":"onBatchCancelled",close:"onClose","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"};function y(n){return function(t,e){t&&typeof n.onError=="function"&&n.onError(t,e),typeof n.onResult=="function"&&n.onResult(e);const r=typeof e?.event=="string"&&g[e.event];if(typeof r=="string"&&typeof n[r]=="function"){const o=n[r];o(e)}}}function h({signatureEndpoint:n,fetch:d}){return function(e,r){if(typeof n>"u")throw Error("Failed to generate signature: signatureEndpoint property undefined.");if(typeof d>"u")throw Error("Failed to generate signature: fetch property undefined.");d(n,{method:"POST",body:JSON.stringify({paramsToSign:r}),headers:{"Content-Type":"application/json"}}).then(o=>o.json()).then(o=>{e(o.signature)}).catch(o=>{e(null,o)})}}window.addEventListener("load",async()=>{const n=document.querySelectorAll(".astro-cloudinary-clduploadwidget");if(n.length===0||((!("cloudinary"in window)||typeof window.cloudinary.createUploadWidget!="function")&&await f("https://upload-widget.cloudinary.com/global/all.js"),!("cloudinary"in window)))return;const d=window.cloudinary;n.forEach(t=>{let e;const r=t.querySelector("button");if(!r)return;r.addEventListener("click",a=>{e||(e=l()),e.open()});const o=t.dataset.clduploadwidgetuploadOptions&&JSON.parse(t.dataset.clduploadwidgetuploadOptions),c=t.dataset.clduploadwidgetuploadSignatureendpoint,u=c&&h({signatureEndpoint:String(c),fetch}),s=y({onError:a=>{const i=new CustomEvent("clduploadwidget:error",{detail:{event:"error",error:a,UploadWidget:t}});t?.dispatchEvent(i)},onResult:a=>{if(typeof a?.event!="string")return;const i=new CustomEvent(`clduploadwidget:${a?.event}`,{detail:{event:a.event,info:a.info,UploadWidget:e}});t?.dispatchEvent(i)}});p(()=>{e||(e=l())});function l(){return d.createUploadWidget({...o,uploadSignature:u},s)}})});

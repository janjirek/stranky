---
import { CldImage } from 'astro-cloudinary';

interface Props {
  estate: {
    title: string;
    type: string; // "prodej" nebo "pronájem"
    thumbnail: string; // Cloudinary ID
    price: string;
    location: string;
    slug: string; // Nyní už víme, že obsahuje např. 'rd-konopac'
    tags: string[];
  };
  isHidden?: boolean;
}

const { estate, isHidden } = Astro.props;

// Logika pro barvu štítku podle typu
const isRent = estate.type.toLowerCase().includes('pronájem');
const typeColor = isRent ? 'bg-orange-600' : 'bg-blue-600';

// Zjištění statusu (např. Prodáno / Rezervováno) z pole tags
const isReserved = estate.tags.some(t => t.toLowerCase().includes('rezerv'));
const isSold = estate.tags.some(t => t.toLowerCase().includes('prodáno'));
---

<article
  class:list={[
    'group relative flex flex-col h-full bg-white dark:bg-slate-800 rounded-3xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-300 border border-slate-100 dark:border-slate-700',
    { 'pointer-events-none opacity-60 grayscale': isSold || isReserved }, 
    { 'opacity-100': !isHidden, 'opacity-0 hidden': isHidden }
  ]}
>
  <a href={`/${estate.slug}`} class="absolute inset-0 z-10" aria-label={estate.title}></a>

  <div class="relative aspect-video overflow-hidden bg-slate-200">
      <CldImage
        src={estate.thumbnail}
        width={800}
        height={450}
        crop="fill"
        alt={estate.title}
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
      />
      
      <div class="absolute top-4 left-4 flex flex-col gap-2 z-20">
          <span class={`px-3 py-1.5 text-xs font-bold uppercase tracking-wider rounded-lg text-white shadow-md ${isSold || isReserved ? 'bg-slate-500' : typeColor}`}>
              {isSold ? 'Prodáno' : isReserved ? 'Rezervováno' : estate.type}
          </span>
      </div>
  </div>

  <div class="p-6 flex flex-col flex-grow relative z-20 pointer-events-none">
      
      <div class="flex items-start text-slate-500 dark:text-slate-400 text-sm uppercase font-bold tracking-wider mb-2">
          <svg class="w-4 h-4 mr-1.5 text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
          <span class="w-full min-w-0">
             {estate.location}
          </span>
      </div>

      <h3 class="text-xl font-extrabold text-slate-900 dark:text-white mb-2 leading-snug group-hover:text-blue-600 transition-colors font-cabinet-grotesk line-clamp-2">
          {estate.title}
      </h3>

      <span class="text-2xl font-extrabold text-blue-600 dark:text-blue-400 mb-4">
          {estate.price}
      </span>

      <div class="mt-auto pt-4 border-t border-slate-100 dark:border-slate-700">
          <div class="flex items-center justify-center w-full py-2.5 text-sm font-bold text-slate-700 bg-slate-50 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors shadow-sm">
              Zobrazit detail
              <svg class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
          </div>
      </div>

  </div>

</article>